import { NextPage, GetStaticProps } from "next";
import Head from "next/head";
import Image from "next/image";
import Link from "next/link";
import { client } from "../libs/client";
import Header from "../components/Header/Header";
import Footer from "../components/Footer/Footer";
import { Blog, Category } from "../interfaces/index";
import ArticleCard from "../components/ArticleCard/ArticleCard";

type Props = { blogs: Blog[]; categories: Category[] };

const Home: NextPage<Props> = ({ blogs, categories }: Props) => {
  return (
    <div className="flex flex-col">
      <Head>
        <title>Hayakawa&apos;s Tech Blog</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className="flex-1 overflow-x-hidden bg-blue-50 block justify-center items-center">
        <Header />
        <div className="min-h-screen lg:flex">
          <div className="lg:w-1/12" />
          <div className="p-6 justify-center lg:flex lg:pt-20 lg:w-9/12">
            <div className="text-gray-600 pb-8 sm:p-8">
              <h1 className="text-gray-800 font-semibold text-2xl mb-10 lg:text-center">
                # タグ
              </h1>
              <ul className="">
                {categories.map((category: Category, index) => (
                  <Link key={index} href={`/category/${category.id}`} passHref>
                    <a className="flex items-center pb-1 pt-1 pl-4">
                      <Image
                        src={
                          category.image ? category.image.url : "/noimage.jpeg"
                        }
                        alt="category image"
                        width="50"
                        height="50"
                      />
                      <li className="ml-4 font-serif" key={index}>
                        #{category.name}
                      </li>
                    </a>
                  </Link>
                ))}
              </ul>
            </div>
            <div className="sm:p-4">
              <h1 className="text-gray-800 font-bold text-3xl mb-10 lg:text-center">
                記事一覧
              </h1>
              <ul>
                {blogs.map((blog: Blog, index) => (
                  <ArticleCard key={index} {...blog} />
                ))}
              </ul>
            </div>
          </div>
          <div className="lg:w-2/12" />
        </div>
      </main>
      <Footer />
    </div>
  );
};

export const getStaticProps: GetStaticProps = async () => {
  const blog = await client.get({ endpoint: "blog" });
  const category = await client.get({ endpoint: "category" });

  return {
    props: {
      blogs: blog.contents as Blog[],
      categories: category.contents as Category[],
    },
  };
};

export default Home;
